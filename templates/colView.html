<head>
	<link rel="stylesheet" type="text/css" href="/static/css/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="/static/css/colView.css">
	<link rel="stylesheet" type="text/css" href="/static/css/types.css">
	<script src="/static/jscript/jquery-1.7.1.min.js"></script>
	
	<link rel="stylesheet" href="/static/jquery-ui-1.10.4.custom/css/ui-lightness/jquery-ui-1.10.4.custom.css" />
	<script src="/static/jquery-ui-1.10.4.custom/js/jquery-ui-1.10.4.custom.js"></script>
	
	<script src="/static/jscript/colView.js"></script>
	<script src="/static/jscript/printDocument.js"></script>
	
	
	
	
	<script>
	//$(document).bind('keydown', 'ctrl+a', changeValueType);
	$(document).ready(function(){
		$(".oneKeyContainer").click(loadDistinctVals)
	
	dbName = "{{dbName}}"
	colName = "{{colName}}"
	dbKeys = null
	indexes = null; //make a list of all the indexes
	indexes2d = null; // make a list of all the 2d indexes
	$.ajax({url:'/ajax/getKeysList', type:'POST', data:JSON.stringify({'colName':colName,'dbName':dbName}), contentType:'application/json', 
	success:function(data){
		dbKeys = data['keys']
		makeAutocompleteField($('#sortField'))
		appendCriteriaField()
	}})
	
	$.ajax({url:'/ajax/gettablesstats/'+dbName, type:'POST',success:function(data){
		var values = data['stats']
		indexes = []
		indexes2d = []
		for(key in values[colName]['indexInfo']){
			var keyStr = values[colName]['indexInfo'][key]['key'][0][0]
			var keyType = values[colName]['indexInfo'][key]['key'][0][1]
			indexes.push(keyStr)
			if(keyType == "2d")
				indexes2d.push(keyStr)
		}
	
		//once we know which tables have 2d indexes, populate the list of options for the geospatial query
		make2dAutocompleteField($('#geosearchfield'))
	}}) // end /ajax/gettablesstats
	})//document.ready
	</script>
</head>

<body style="padding:20px;">
<div id="breadCrumbPath"><h2><a href='/'>Home</a> -> <a href='/db/{{dbName}}'>{{dbName}}</a> -> {{colName}}</h2></div>
<div style="font-size:30px;height:35px;margin-top:10px;margin-left:15px;">{{count}} total entries</div>

<div id="schema" style="float:left;width:50%;height:200px;overflow:auto;">
	
	{% if schema == None %}
		Scan the Table to create a schema and enable autocomplete
	{% else %}
		<ul>
		{% for key in schema %}
		{% set percentContaining = key['percentContaining'] %}
		{% set total = key['totalOccurrences'] %}
		{% set types = key['value']['types'] %}
		
		{# create a dictionary to convert variety types to the correct css class for color styling #}
		{% set varietyTypeClasses = {'ObjectId':'oidType', 'String':'stringType', 'Boolean':'boolType','null':'noneType','Number':'numType'} %}
		
		<li class="oneKeyContainer" data-field="{{key['_id']['key']}}"><div class="key">{{key['_id']['key']}}</div>
		<div class='stats'> <span class='count');">count:{{total}} ({{percentContaining|round|int}}%)</span> &bull; 
		<span class='types'>{% for type in types %}<span class={{varietyTypeClasses[type]}}>{{type}}</span>{% if loop.index0 < ((types|length)-1) %}, {% endif %}{%endfor%}
		
		</span></div> <!--end stats div -->
		
		</li>
	
		{% endfor %}
		</ul>
	{% endif %}
	
</div> <!--Schema div -->
<script>$("#schema").data('expanded', false)</script>


<span id="fieldInfo" style="float:left;height:200px;width:50%;overflow:auto;">
<h2>Field Info</h2>
	<div id="fieldlist"></div>
</span> <!--fieldInfo-->

<div style="width:100%;clear:both;"></div>
<div><a id="schemaExpand" onclick="javscript:toggleSchemaExpand()">Expand/Collapse</a></div>
<button onclick="javascript:loadSchema()">Get Schema</button>
<h2>Query Div - <a onclick="javascript:$('#valTypeInstructions').dialog();" style='font-size:.5em;'>How to specify value types</a></h2> 
<div style="margin-bottom:20px;" id="queryDiv" style="clear:both";>
	<!--appendCriteriaField dynamically puts fields here -->
</div>
<br><br>
<div><button style="clear:both;" onclick="javascript:appendCriteriaField()">Add Criteria Field</button></div>

<div><input id="geosearch" type="checkbox" onchange="javascript:$('#geoSearchDiv').slideToggle(150)" name="geosearch" value='true'><label for="geosearch" style="display:inline">Search with geospatial index</label></div>

<div id='geoSearchDiv' style='display:none'>
<input type="text" id='geosearchfield' placeholder='field to search with'>
<input type="text" id='geosearchx' placeholder="X value">
<input type="text" id='geosearchy' placeholder="Y value">
</div> <!--geoSearch -->
<div id='sortDiv'>
	Sorty by:<input id='sortField' type="text" placeholder='field'>
	<select id='sortDirection'>
		<option value='1'>Ascending</option>
		<option value='-1'>Descending</option>
	</select>
</div> <!--sort div -->
<button onclick="javascript:querySkip=0;query(querySkip, pageSize)">Search</button>
<div id="queryCount"></div>
<div id="resultsDiv">
	<!--results will be placed here by javascript -->
</div> <!--resultsDiv-->
<a style="cursor:pointer;cursor:hand" onclick="javascript:alert('not implemented yet')">Previous</a> <a style="cursor:pointer;cursor:hand" onclick="querySkip=querySkip+pageSize;javascript:query(querySkip, pageSize)">Next</a>

<div id='valTypeInstructions'>
<h2>How to specify the data type in a query</h2>
<h4>When querying for the value "42", do you mean the number 42 or the string "42"?  How about searching for a date?  The Mighty Mongo uses a regular-expressed-based system to make this fast and easy.  Read on for more info.</h4>
<ul>
	<li>Booleans are either <span class='boolType'>true</span> or <span class='boolType'>false</span></li>
	<li>Any digits 0-9 is a number.  An optional decimial point or negative signs works too.  Examples: <span class=numType>42</span>, <span class=numType>42.2</span>, <span class=numType>-5</span></li>
	<li>Anything inside of double quotes (<span class=stringType>"..."</span>) is a string.  For example, <span class=stringType>"Hello world"</span>, <span class=stringType>"42"</span></li>
	<li>A date/time has two formats.  One with just a date and one with a date & time.  Both start with "dt:".  Just a date has the format dt:YYYY:MM:DD.  For example: <span class=dateType>dt:2014-12-10</span>.  Date & time goes dt:YYYY-MM-DDTHH:MM:SS.  For example: <span class=dateType>dt:2014-12-10T12:12:12</span>  </li>
	<li>For a nullType (some languages called it 'none'), just type <span class=noneType>null</span></li>
	<li>For an objectID, type <span class=oidType>oid:oid_code</span> where oid_code must be a 24-character hexadecimal (0-9 and a-f) string of characters. i.e. <span class=oidType>oid:4f13b4296118ad10e7050602</span></li>
</ul>
<p>Go ahead and try it out in a query!</p>

</div>
</body>
