<head>
<script type="text/javascript" src="/static/jscript/jquery-1.7.1.min.js"></script>
<script type='text/javascript'>
keyStats = 5;
function getKeyStats(){
	data = {};
	data["dbName"] = "{{db.name}}"
	data["colName"] = "{{col.name}}"
	$.getJSON("/ajax/getkeystats", data, function(data){keyStats = data['stats']; console.log("data received")})
}

function printKeyStats(keyStats, div){
	console.log("running")
	var statsList = makeKeysList(keyStats)
	$("#keyStatsDiv").append(statsList)
} //end printKeyStats

function makeKeysList(keyStats){
	var list = document.createElement('ul')
	for (var key in keyStats){
		var item = document.createElement('li')
		$(item).append(key + "("+keyStats[key]['count']+")")
		if(Object.keys(keyStats[key]['subKeys']).length > 0)
			$(item).append(makeKeysList(keyStats[key]['subKeys']))
		$(list).append(item)
	}
	return list
}
</script>

<script type='text/javascript'>
	function query(){
		criteria = $("#queryBar").val()
		dbName = "{{db.name}}"
		colName = "{{col.name}}"
		data = {'dbName':dbName, 'colName':colName, 'criteria':criteria}
		$.getJSON("/ajax/query", data, function(data){
			console.log(data)
		}) // end getJSON
	} // end query
</script>
</head>

<body>
<a href='/'>Home</a> -> <a href="/db/{{db.name}}">{{db.name}}</a>
Collection: {{col.name}}
<br><br>
This collection has {{col.count()}} entries.

This collection has the following schemas: <br>
<button onclick="getKeyStats()">get Stats</button><br>
<button onclick="printKeyStats(keyStats, '#keyStatsDiv')">print</button>

<div id="keyStatsDiv">

</div>

<input type="text" id="queryBar" placeholder="enter query here"><button id="submitQuery" onclick="query()">Search</button>

<div id="queryResults">

</div>
</body>