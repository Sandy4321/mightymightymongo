<head>
<script type="text/javascript" src="/static/jscript/jquery-1.7.1.min.js"></script>
<script type='text/javascript'>
keyStats = 5;
function getKeyStats(){
	data = {};
	data["dbName"] = "{{db.name}}"
	data["colName"] = "{{col.name}}"
	$.getJSON("/ajax/getkeystats", data, function(data){keyStats = data['stats']; printKeyStats(keyStats)})
}

function printKeyStats(keyStats, div){
	console.log("running")
	var statsList = makeKeysList(keyStats)
	$("#keyStatsDiv").append(statsList)
} //end printKeyStats

function makeKeysList(keyStats){
	var list = document.createElement('ul')
	for (var key in keyStats){
		var item = document.createElement('li')
		$(item).click(function(){console.log(self)})
		$(item).append(key + "("+keyStats[key]['count']+": " + keyStats[key]['types']+")")
		if(Object.keys(keyStats[key]['subKeys']).length > 0)
			$(item).append(makeKeysList(keyStats[key]['subKeys']))
		$(list).append(item)
	}
	return list
}
</script>

<script type='text/javascript'>
	$(document).ready(function(){
		getKeyStats()
		
		}
	)
	function query(){
		criteria = $("#queryBar").val()
		dbName = "{{db.name}}"
		colName = "{{col.name}}"
		data = {'dbName':dbName, 'colName':colName, 'criteria':criteria}
		$.getJSON("/ajax/query", data, function(data){
			console.log(data)
		}) // end getJSON
	} // end query
</script>
</head>

<body>
<a href='/'>Home</a> -> <a href="/db/{{db.name}}">{{db.name}}</a>
Collection: {{col.name}}
<br><br>
This collection has {{col.count()}} entries.

This collection has the following schemas: <br>

<div id="keyStatsDiv">

</div>

<div id="queryFields">

</div>
<div><button onclick="makeQueryField()">Add Query Field </div>
<script type='text/javascript'>
	function makeQueryField(){
		var span = document.createElement('span')
		$(span).attr('class', 'queryFieldSpan')
		var select = makeQueryFieldSelect()
		var logicType = document.createElement('select')
		var types = ['equals', 'in', 'exists']
		for(var type in types){
			var option = document.createElement('option')
			$(option).html(types[type])
			$(logicType).append(option)
		}
		$("#queryFields").append(select)
		$("#queryFields").append(logicType)
		$("#queryFields").append("<br>")
	}
	
	function makeQueryFieldSelect(){
		var select = document.createElement('select');
		$(select).attr('class', 'queryFieldSelect')
		for(var key in keyStats){
			var option = document.createElement('option')
			$(option).html(key)
			$(select).append(option)
		}
		return select
	}
</script>
<button id="submitQuery" onclick="query()">Search</button>

<div id="queryResults">

</div>
</body>